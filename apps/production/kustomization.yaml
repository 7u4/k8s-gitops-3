apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - secrets
  - ../base
  - kube-system
  - default
  - podinfo

patchesStrategicMerge:
  - podinfo/patch-values.yaml

configMapGenerator:
- name: app-global-settings
  envs:
  - external_IPs.env

vars:
- name: GLOBAL_DOMAIN
  objref:
    kind: ConfigMap
    name: app-global-settings
    apiVersion: v1
  fieldref:
    fieldpath: data.DOMAIN
- name: GLOBAL_DOMAIN_CERT
  objref:
    kind: ConfigMap
    name: app-global-settings
    apiVersion: v1
  fieldref:
    fieldpath: data.DOMAIN_CERT
- name: GLOBAL_EXTERNAL_SUBNET_PREFIX
  objref:
    kind: ConfigMap
    name: app-global-settings
    apiVersion: v1
  fieldref:
    fieldpath: data.EXTERNAL_SUBNET_PREFIX
- name: GLOBAL_EXTERNAL_IP_PLEX
  objref:
    kind: ConfigMap
    name: app-global-settings
    apiVersion: v1
  fieldref:
    fieldpath: data.lb_plex
- name: GLOBAL_EXTERNAL_IP_OPENVPN
  objref:
    kind: ConfigMap
    name: app-global-settings
    apiVersion: v1
  fieldref:
    fieldpath: data.lb_openvpn
